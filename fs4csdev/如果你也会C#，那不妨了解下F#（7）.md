# é¢å‘å¯¹è±¡ç¼–ç¨‹ä¹‹ç»§æ‰¿ã€æ¥å£ä¸å€¼ç±»å‹

## å‰è¨€

é¢å‘å¯¹è±¡ä¸‰å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ä¸Šä¸€ç¯‡ä¸­ä»‹ç»äº†ç±»çš„å®šä¹‰ï¼Œä¸‹é¢å°±äº†è§£ä¸‹F#ä¸­ç»§æ‰¿å’Œå¤šæ€çš„å®ç°å§ã€‚ğŸ˜‹

åŒæ ·çš„ï¼Œé¢å‘å¯¹è±¡çš„åŸºç¡€æ¦‚å¿µä¸å¤šè¯´ï¼Œå°±å¯¹æ¯”ä¸‹è¯­æ³•ï¼Œå¹¶ç®€å•è¯´æ˜ä¸‹åº”è¯¥æ³¨æ„çš„åœ°æ–¹ã€‚

## ç»§æ‰¿

### å¯¹è±¡è¡¨è¾¾å¼ï¼ˆObject Expressionsï¼‰

åœ¨ä»‹ç»ç»§æ‰¿ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹F#é¢å‘å¯¹è±¡ä¸­å¸¸ç”¨çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼š**å¯¹è±¡è¡¨è¾¾å¼**ã€‚å®ƒç”¨äº**åŸºäºç°æœ‰ç±»å‹**åˆ›å»ºåŒ¿åå¯¹è±¡ç±»å‹ï¼Œæ¯”å¦‚æœ‰æ—¶å€™åªå¸Œæœ›åœ¨ä¸€ä¸ªæˆ–å°‘æ•°å‡ ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹æˆå‘˜å‡½æ•°çš„å®ç°ï¼Œè¿™æ—¶å€™ä¸ä¸€å®šè¦é‡æ–°å®šä¹‰ä¸€ä¸ªç°æœ‰ç±»å‹çš„æ´¾ç”Ÿç±»ç„¶åå®ä¾‹åŒ–ã€‚

å¯åœ¨åˆ›å»ºå¯¹è±¡æ—¶é€šè¿‡å…³é”®å­—`with`æä¾›æ–°çš„å‡½æ•°å®ç°ä»£ç ï¼š

```F#
let oriPt = {
    new Point2D() with 
        member __.ToString() = "æˆ‘æ˜¯åŸç‚¹"
}
```

`oriPt`ä½¿ç”¨å¯¹è±¡è¡¨è¾¾ç¤ºå®ä¾‹åŒ–ï¼Œå¹¶é‡å†™äº†åŸºç±»çš„`ToString`æ–¹æ³•ï¼Œè€Œä¸æ˜¯é‡æ–°å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»ã€‚å…¶å®è¿™ä¹Ÿæ˜¯ç»§æ‰¿ï¼Œåªæ˜¯è¿™æ ·ä¼šå‡å°‘åˆ›å»ºæ–°çš„å‘½åç±»å‹æ‰€éœ€çš„ä»£ç å’Œå¼€é”€ã€‚

å¯¹è±¡è¡¨è¾¾å¼éœ€è¦æ”¾åœ¨ä¸€å¯¹å¤§æ‹¬å·ï¼ˆ`{}`ï¼‰ä¸­ï¼Œå…¶ä¸­çš„**`new`ä¸å¯çœç•¥**ï¼Œä¸”**ä¿®æ”¹çš„æˆå‘˜å‡½æ•°å¿…é¡»æ˜¯è™šæ–¹æ³•ï¼ˆåŒ…æ‹¬æŠ½è±¡æ–¹æ³•ï¼‰**ã€‚

### ç»§æ‰¿çš„å®ç°

ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡çš„ä¸€å¤§ç‰¹æ€§ï¼Œä¸‹é¢åˆ†åˆ«æ˜¯C#å’ŒF#ä¸­çš„è¯­æ³•å¯¹æ¯”ã€‚å®šä¹‰ä¸€ä¸ªç»§æ‰¿äº`Point2D`çš„ç±»ï¼š

```C#
public class Particle : Point2D
{
    public double Mass { get; set; }
}
```

```F#
type Particle() =
    inherit Point2D()
    member val Mass = 0. with get, set
```

åœ¨F#ä¸­ï¼Œè‹¥å­ç±»éœ€è¦è°ƒç”¨åŸºç±»æ–¹æ³•ï¼ŒåŒæ ·ä½¿ç”¨`base`å…³é”®å­—ã€‚è€Œä¸”ï¼Œå¦‚æœæœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œé€šå¸¸ä½¿ç”¨å¯¹è±¡è¡¨è¾¾å¼åœ¨éä¸»æ„é€ å‡½æ•°ä¸­è¿”å›å¯¹è±¡ã€‚

```

```











## ç±»å‹è½¬æ¢

åœ¨[æ•°å€¼è¿ç®—å’Œæµç¨‹æ§åˆ¶è¯­æ³•](http://www.cnblogs.com/hjklin/p/fs-for-cs-dev-2.html)ä¸­æˆ‘ä»¬ä»‹ç»F#ä¸­æ•°å€¼è½¬æ¢éœ€è¦ä½¿ç”¨å¯¹åº”çš„å‡½æ•°ï¼Œå¦‚è½¬æˆ`Int`ç±»å‹ä½¿ç”¨`int`å‡½æ•°ç­‰ã€‚

ä½†åŸºç±»å’Œå­ç±»ä¹‹é—´çš„è½¬æ¢ï¼ŒF#æä¾›`upcast`ï¼ˆå­ç±»è½¬ä¸ºåŸºç±»ï¼‰å’Œ`downcast`ï¼ˆåŸºç±»è½¬ä¸ºå­ç±»ï¼‰å‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œæˆ–è€…ä½¿ç”¨å¯¹åº”çš„ç¬¦å·å‡½æ•°ï¼š`:>`å’Œ`:?>`ã€‚

```
type Base() = class end							//å®šä¹‰åŸºç±»
type Derived() = inherit Base()					//å®šä¹‰å­ç±»
let myDerived = Derived()						
let upCaseResult = myDerived :> Base			//ä½¿ç”¨:>è½¬æ¢ä¸ºåŸºç±»
let upCaseResult2 : Base = upcast myDerived		//ä½¿ç”¨upcastè½¬æ¢ä¸ºåŸºç±»
let downCastResult = upCastResult :?> Derived	//ä½¿ç”¨:?>è½¬æ¢ä¸ºå­ç±»
let downCastResult2 : Derived = downcast cast	//ä½¿ç”¨downcastè½¬æ¢ä¸ºå­ç±»
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œupcastæ“ä½œæ€»æ˜¯å®‰å…¨çš„ï¼›ä½†downcastå¹¶ä¸€å®šæˆåŠŸï¼Œå¯ä½¿ç”¨`:?`åœ¨è½¬æ¢å‰è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œå¦åˆ™è½¬æ¢å¤±è´¥ä¼šå¼•å‘`InvalidCastException`å¼‚å¸¸ã€‚

```F#
if upCastResult :? Derived then upCastResult :?> Derived
```

`:?`è¿˜å¯ä»¥ç”¨åœ¨æ¨¡å¼åŒ¹é…ï¼ˆ[æ•°å€¼è¿ç®—å’Œæµç¨‹æ§åˆ¶è¯­æ³•](http://www.cnblogs.com/hjklin/p/fs-for-cs-dev-2.html)æœ‰ä»‹ç»è¿‡ï¼Œç±»ä¼¼äºC#ä¸­çš„`switch`ï¼‰é‡Œã€‚

```F#
match shape with
| :? Circle    as c -> printfn "circle with radius %f" c.Radius
| :? Rectangle as r when r.Length = r.r.Height 
                    -> printfn "%f x %f square"    r.Length r.r.Height
| :? Rectangle as r -> printfn "%f x %f rectangle" r.Length r.r.Height
| _                 -> printfn "<unknown shape>"
| null              -> raise (ArgumentNullException("shape"))
```

æ­¤æ®µä»£ç ä»ä¸­ ["Whatâ€™s New in C# 7.0"](https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/) ï¼ˆä¸­æ–‡ç¿»è¯‘[ã€Š[Cï¼ƒ7.0ä¸­æœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Ÿ](http://www.cnblogs.com/powertoolsteam/p/whats-new-in-C-sharp-7-0.html)ã€‹]ï¼‰C#7.0çš„æ¨¡å¼åŒ¹é…çš„ç¤ºä¾‹ä»£ç è½¬æ¢è€Œæ¥çš„ã€‚C#åŸä»£ç å¦‚ä¸‹ï¼š

```C#
switch(shape)
{
    case Circle c:
        WriteLine($"circle with radius {c.Radius}");
        break;
    case Rectangle s when (s.Length == s.Height):
        WriteLine($"{s.Length} x {s.Height} square");
        break;
    case Rectangle r:
        WriteLine($"{r.Length} x {r.Height} rectangle");
        break;
    default:
        WriteLine("<unknown shape>");
        break;
    case null:
        throw new ArgumentNullException(nameof(shape));
}
```

C#çš„ä»£ç ä¸F#ä¸€æ ·ï¼Œæœ€åä¸€é¡¹`null`å…¶å®æ˜¯æ— æ³•è¢«åŒ¹é…åˆ°çš„ã€‚F#ä¸­ä»¥**â€œ`_`â€ä½œä¸ºé€šé…ç¬¦**ã€‚

å¯ä»¥å‘ç°C#æœ€è¿‘å‡ ä¸ªå¤§ç‰ˆæœ¬ä¸­çš„å¤§å¤šæ–°åŠŸèƒ½F#ä¸­éƒ½å·²ç»æœ‰äº†ï¼ŒC#åœ¨å‡½æ•°å¼çš„é“è·¯æ˜¯è¶Šèµ°è¶Šè¿œäº†ã€‚ğŸ‘

*F#ä¸­è¿˜æ²¡æœ‰`nameof`æ“ä½œç¬¦ï¼Œå·²ç»å®ç°ï¼Œä¼°è®¡ä¼šåœ¨æ–°ç‰ˆæœ¬ä¸­é‡Šå‡ºã€‚è€ŒC#7.0çš„åŠŸèƒ½ä¹Ÿå¯ä»¥åœ¨[Visual Studio â€œ15â€ Preview 4](https://www.visualstudio.com/news/releasenotes/vs15-relnotes)ä¸­ä½“éªŒã€‚*

### è£…ç®±ï¼ˆBoxingï¼‰å’Œæ‹†ç®±ï¼ˆUnboxingï¼‰

F#ä¸­ä½¿ç”¨`box`å’Œ`unbox`å‡½æ•°è¿›è¡Œè£…ç®±å’Œæ‹†ç®±æ“ä½œï¼š

```
let i1 = 4
let o = box i	//æ­¤æ—¶oä¸ºobjç±»å‹
let i2 ï¼š int = unbox o
```

åœ¨F#ä¸­ï¼Œ`obj`ä¸º`System.Object`çš„åˆ«åã€‚ 

## æ¥å£

### æ¥å£çš„å®šä¹‰å’Œä½¿ç”¨

æŠ½è±¡ç±»å†³å®šä¸€ä¸ªå¯¹è±¡**â€œæ˜¯ä»€ä¹ˆâ€**ï¼Œè€Œæ¥å£å†³å®šäº†ä¸€ä¸ªå¯¹è±¡**â€œå…·æœ‰ä»€ä¹ˆåŠŸèƒ½â€**ã€‚æˆ‘ä»¬å…ˆçœ‹F#ä¸­çš„å®šä¹‰ï¼š

```F#
type I2DLocation = interface		//å®Œæ•´å®šä¹‰æ–¹å¼
    abstract member X : float with get, set
    abstract member Y : float with get, set
end
type I2DLocation =					//ç®€è¦å®šä¹‰æ–¹å¼
    abstract member X : float with get, set
    abstract member Y : float with get, set
```

åœ¨F#ä¸­ï¼Œè‹¥ä¸ä½¿ç”¨`interface`å…³é”®å­—æ˜¾ç¤ºå®šä¹‰ï¼Œ**åªè¦ç±»çš„æ‰€æœ‰æˆå‘˜éƒ½ä¸ºæŠ½è±¡ï¼ˆ`abstract`ï¼‰çš„ï¼Œå°±ä¼šè¢«ç±»å‹æ¨æ–­ç³»ç»Ÿæ¨æ–­ä¸ºæ¥å£**ã€‚

**æ¥å£åœ¨F#éœ€è¦æ˜¾ç¤ºå®ç°**ï¼Œæ‰€ä»¥åœ¨å®ç°æ¥å£åï¼Œä½¿ç”¨æ—¶ä¹Ÿéœ€è¦è½¬æ¢è‡³æ¥å£ç±»å‹ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨æ¥å£çš„å±æ€§æˆ–æ–¹æ³•ã€‚

```
type Point2D(xValue:double, yValue:double) as this=
	â€¦â€¦	//çœç•¥å…¶ä»–ä»£ç 
	interface I2DLocation with
        member this.X with get() = this.X and set(v) = this.X <- v
        member this.Y with get() = this.Y and set(v) = this.Y <- v
let pt = Point2D()
let l = pt :> I2DLocation	//ä½¿ç”¨å‘ä¸Šè½¬æ¢ç¬¦ï¼Œå› ä¸ºå®ç°çš„æ¥å£å·²åœ¨ç¼–è¯‘æœŸç¡®å®š
printfn "x=%f,y=%f" l.X l.Y
```

### å¯¹è±¡è¡¨è¾¾å¼å®ç°æ¥å£çš„åŒ¿åç±»å‹

[å¯¹è±¡è¡¨è¾¾å¼](#å¯¹è±¡è¡¨è¾¾å¼ï¼ˆObject Expressionsï¼‰)ä¸ä»…å¯åŸºäºç±»åˆ›å»ºåŒ¿åç±»å‹ï¼ŒåŒæ ·å¯åŸºäºæ¥å£åˆ›å»ºåŒ¿åç±»å‹ã€‚åœ¨C#ä¸­ï¼Œæˆ‘ä»¬åœ¨åŸºäº`IComparer`æ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œéƒ½è¦å®šä¹‰ä¸€ä¸ªå®ç°`IComparer`çš„ç±»ã€‚è€Œåœ¨F#ä¸­ï¼Œå› ä¸ºæœ‰å¯¹è±¡è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœå»å¾ˆå¤šä»£ç ã€‚å‡è®¾æˆ‘ä»¬å°†ä¸€äº›`Point2d`åŸºäºXåæ ‡æ’åºï¼š

```F#
open System.Collections.Generic
let pts = List<_>(
    [| Point2D();Point2D(4.,2.); Point2D(3.,4.);Point2D(6.,2.); |]
)
pts.Sort({new IComparer<Point2D> with 
    member __.Compare(l, r) =
        int(l.X - r.X)
})
```





ä»£ç ä½¿ç”¨`List<T>`å®šä¹‰äº†å‡ ä¸ªç‚¹ï¼Œç„¶åä½¿ç”¨å¯¹è±¡è¡¨è¾¾å¼å®šä¹‰äº†ä¸€ä¸ªåŒ¿åç±»çš„å®ä¾‹ä¼ å…¥Sortæ–¹æ³•ã€‚è€Œè¿™æ ·ä¸éœ€è¦åƒC#ä¸­é‡æ–°å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚*è™½ç„¶è¿™æ ·çš„åŠŸèƒ½åœ¨C#ä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯Linqä¸­çš„Sortï¼Œä½†æˆ‘ä»¬ç°åœ¨ä»‹ç»é¢å‘å¯¹è±¡å°±å…ˆä»¥è¿™ä¸ºä¾‹äº†ã€‚*

å¯ä»¥çœ‹åˆ°åŸºäºæ¥å£å®šä¹‰çš„å¯¹è±¡è¡¨è¾¾å¼ä¸åƒåŸºäºç±»çš„ï¼Œåœ¨**æ¥å£ååä¸èƒ½ä½¿ç”¨å‚æ•°**ï¼Œå› ä¸ºæ¥å£æ— æ³•å®ä¾‹åŒ–ã€‚

### IDisposableæ¥å£

è¯´åˆ°æ¥å£ï¼Œå°±è¯¥è¯´ä¸‹.NETä¸­æ¯”è¾ƒç‰¹æ®Šçš„`IDisposable`ï¼Œ

## æ‰©å±•

### ç±»æ‰©å±•

### æ¥å£æ‰©å±•

### 

##ç»“æ„ï¼ˆStructï¼‰

åœ¨å‰é¢ä»‹ç»çš„é¢å‘å¯¹è±¡ç±»ä»¥åŠç±»æ¶‰åŠçš„ç›¸å…³å†…å®¹ï¼Œä½†åœ¨ç¤ºä¾‹çš„ä»£ç æ„Ÿè§‰ä½¿ç”¨ç±»å¹¶æ²¡æœ‰æ„Ÿè§‰æœ‰ä»€ä¹ˆä¼˜åŠ¿ã€‚å…¶å®åƒä¸Šä¸€ç¯‡ä¸­çš„`Point2D`ç±»ï¼Œä½¿ç”¨ç»“æ„ï¼ˆ`Struct`ï¼‰ä¹Ÿè®¸ä¼šæ›´å¥½ä¸€äº›ã€‚

ç»“æ„æ˜¯å€¼ç±»å‹ï¼Œä¸ç±»çš„å¼•ç”¨ç±»å‹ä¸åŒï¼Œåœ¨å†…å­˜åˆ†é…ä¸Šæ˜¯è¢«åˆ†é…åœ¨æ ˆï¼ˆStackï¼‰ä¸Šï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¸­å†…å­˜æ¶ˆè€—æ›´å°‘ï¼Œè€Œä¸”ä¸éœ€è¦åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ã€‚è¿™æ–¹é¢çŸ¥è¯†ç†Ÿæ‚‰.NETæ¡†æ¶çš„å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚

ä¸‹é¢æ˜¯ç»“æ„çš„å®šä¹‰ï¼š

```F#
type Point2D(xValue:double, yValue:double) = struct
    member this.X = xValue
    member this.Y = yValue
end
[<Struct>]
type Point2D(xValue:double, yValue:double) =
    member this.X = xValue
    member this.Y = yValue
```

ç»“æ„å®šä¹‰ä¸ç±»ä¸€æ ·ï¼Œåœ¨å†…å®¹ä¸ä¸ºç©ºæ—¶å¯çœç•¥`struct end`å…³é”®å­—ã€‚ä¸è¿‡è¿™æ ·å°±å’Œç±»ä¸€æ ·äº†ï¼Œæ‰€ä»¥**éœ€è¦åŠ ä¸Š`[<Struct>]`ç‰¹æ€§**ä»¥ç¤ºåŒºåˆ«ã€‚è¿™å’ŒæŠ½è±¡ç±»ã€å¯†å°ç±»çš„å®šä¹‰ä¸€è‡´ã€‚

## æšä¸¾ï¼ˆEnumï¼‰

æšä¸¾åœ¨F#ä¸­æ¯”è¾ƒå°‘ç”¨ï¼Œæ›¿ä»£çš„æ˜¯ä½¿ç”¨**å¯åŒºåˆ†è”åˆ**ï¼ˆDiscriminated Unionsï¼Œå¸¸è¢«ç§°ä½œDUï¼‰ã€‚æšä¸¾å¯çœ‹ä½œæ˜¯å¯åŒºåˆ†è”åˆçš„ç®€åŒ–ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ç­‰ä»‹ç»å¯åŒºåˆ†è”åˆæ—¶å†è¯´æ˜ã€‚ä¸‹é¢æ˜¯æšä¸¾çš„å®šä¹‰åŠä¸å…¶åŸºç¡€ç±»å‹çš„è½¬æ¢ï¼š

```
type Card =
    | Jack = 11
    | Queen = 12
    | King = 13
    | Ace = 14
let q = enum<Card>(12)	//intè½¬ä¸ºenumç±»å‹
let i = int Card.King	//enumè½¬ä¸ºintç±»å‹
```

## æ³›å‹åŠçº¦æŸ


